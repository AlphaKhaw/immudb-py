dist: bionic
language: python
python: 
    - 3.8

addons:
    apt:
        sources:
            - golang: "ppa:longsleep/golang-backports"
        packages:
            - golang-go
            - wget
            - unzip

stage:
    - getgo
    - immudbbuild
    - pythontest
    
install:
    - pip install -r requirements.txt

jobs:
    include:
        - stage: getgo
          name: "GetGo"
          script:
            - wget https://golang.org/dl/go1.15.1.linux-amd64.tar.gz
            - tar -C /usr/local -xzf go1.15.1.linux-amd64.tar.gz
            
        - stage: immudbbuild
          name: "ImmuDBBuild"
          script:
            - wget https://github.com/codenotary/immudb/archive/master.zip
            - unzip master.zip
            - PATH="/usr/local/go/bin/:$PATH" make -C immudb-master
            - immudb-master/immudb -d
          
        - stage: pythontest
          name: "PythonTest"
          script: pytest

    
